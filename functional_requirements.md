## "Авансовый отчет командировки". Что я хочу по функционалу:

# 1. Ролевая модель:
- Неавторизованный пользователь
- Администратор
- Авторизованный пользователь

# 2. Интерфейс:
2.1. Неавторизованный пользователь:
- Стартовое сообщение с информацией о том, что умеет делать бот.
- markup кнопка "Заявка на регистрацию". 
- markup кнопка "Помощь". Информация о том, что умеет делать бот.
2.2. Администратор.
- Стартовое сообщение с информацией о том, что умеет делать бот для Администратора.
- markup кнопка "Пользователи"
- markup кнопка "Новый пользователь"
- markup кнопка "Помощь"
2.3. Авторизованный пользователь.
- Стартовое сообщение с информацией о том, что умеет делать бот для Авторизованного пользователя.
- markup кнопка "Авансовый"
- markup кнопка "Помощь"

# 3. Функционал и процессы.
3.1. Неавторизованный пользователь.
- markup кнопка "Заявка на регистрацию"
1) После нажатия кнопки "Заявка на регистрацию" появляется новое сообщение "Введите Вашу фамилию".
Пользователь вводит Фамилию.
Предыдущее сообщение удаляется.
2) Появляется новое сообщение "Введите Ваше имя"
Пользователь вводит имя.
Предыдущее сообщение удаляется.
3) Появляется сообщение "Введите Ваше отчество"
Пользователь вводит отчество.
Предыдущее сообщение удаляется.
4) Появляется сообщение "Введите Ваш e-mail"
Ползователь вводит e-mail
Предыдущее сообщение удаляется.
5) Автоматически определяется telegram ID пользователя.
6) Появляется сообщение, что заявка на регистрацию направлена на рассмотрение администраторам.
7) У всех пользователей с правами Администратор появляется сообщение, что поступила заявка на регистрацию нового ползьователя, сведения о новом ползовтеле, 2 inline-кнопки "Зарегистрировать" и "Отклонить".
8) Пользователь нажимает одну из кнопок.
Если администратор нажимает кнопку "Зарегистрировать", регистрируется новый пользователь. Пользователю отправляется сообщение, что он зарегистрирован и может пользоваться ботом, пользователю присваиваются права "Авторизованный пользователь" и у него обновляется клавиатура.
Если администратор нажимает кнопку "Отклонить", то новый пользователь не регистрируется, новый пользователь получает сообщение, что его заявка на регистрацию отклонена.
- markup кнопка "Помощь". Информация о том, что умеет делать бот.
1) Пользователь нажимает кнопку "Помощь"
2) Пользователю направляется сообщение с инструкцией (общая информация про бот, что нужно сделать для регистрации).
3.2. Администратор.

- markup кнопка "Пользователи"
1) После нажатия данной кнопки, появляется список пользователей в виде inline клавиатуры в 2 ряда:
первая кнопка в ряде с текстом "Фамилия И.О." пользователя. Если нажать на эту кнопку, приходит новое сообщение с детальной информацией о пользователе, а также появляется новое сообщение -  список пользователей в виде inline клавиатуры в 2 ряда.
вторая кнопка "Удалить". После нажатия этой кнопки пользователь удаляется из списка авторизованных пользователей. Он приобретает статус неавторизованного пользователя. Предыдущее сообщение удаляется, появляется новое сообщение со списком пользователей в виде inline клавиатуры в 2 раяда.

- markup кнопка "Новый пользователь"
1) После нажатия кнопки "Новый пользователь" появляется новое сообщение "Введите фамилию".
Пользователь вводит Фамилию.
Предыдущее сообщение удаляется.
2) Появляется новое сообщение "Введите имя"
Пользователь вводит имя.
Предыдущее сообщение удаляется.
3) Появляется сообщение "Введите отчество"
Пользователь вводит отчество.
Предыдущее сообщение удаляется.
4) Появляется сообщение "Введите e-mail"
Ползователь вводит e-mail
Предыдущее сообщение удаляется.
5) Появляется сообщение "Введите Telegram ID".
Пользователь вводит Telegram ID.
Предыдущее сообщение удаляется.
6) Появляется сообщение "Выберите роль пользователя" с 2-мя inline-кнопками: "Пользователь" и "Администратор". В зависимости от нажатия кнопки, новому пользователю присваивается роль в системе.
Предыдущее сообщение удаляется.
7) Появляется новое сообщение, что зарегистрирован новый опльзователь.

- markup кнопка "Помощь". 
1) Пользователь нажимает кнопку "Помощь"
2) Пользователю направляется сообщение с инструкцией (общая информация про бот, что нужно сделать администратору для совершения различных действий с описанием кнопок).

3.1. Авторизованный пользователь.
- markup кнопка "Авансовый"
Общая цель чат-бота - предоставить авансовый отчет в excel-формате пользователю по результатам переданной информации (в виде pdf-файлов или текста). Есть утвержденный шаблон авансовог отчета.
Пользователь может передавать чат-боту информацию для авансового отчета:

Данные из учетной записи пользователя:
Наименование организации
Фамилия, имя, отчество
Табельный номер
Структурное подразделение
Должность

Приказ о командировке в формате pdf. В приказе содержится следующий состав данных для авансового отчета:
Наименование организации
Номер приказа
Дата приказа
Срок командировки (количество дней)
В рамках одной командировки может быть только один приказ.

Электронный билет в формате pdf. В электронном билете содержится следующая информация для авансового отчета:
Дата покупки билета.
Номер билета
Стоимость билета.

В рамках одной командировки может быть куплено несколько билетов. В зависимости от авиакомпании, формат pdf-файла может отличаться, это надо учитывать при парсинге. Как правило, есть 2 основные авиакомпании: АЛРОСА и S7.

При формировании информации, если не получилось сделать парсинг данных, то пользователю надо предоставить возможность ввода этой информации вручную.

Описание процесса после нажатия кнопки "Авансовый":
1) Появляется сообщение "Вложите pdf-файл с приказом".
Пользователь направляет pdf-файл с приказом.
Предыдущее сообщение удаляется.
2) Появляется сообщение "Вложите pdf-файл c билетом".
Пользователь направлет pdf-файл с билетом.
Предыдущее сообщение удаляется.
Направляется нвое сообщение: есть ли еще билет и inline клавиатура с 2-мя кнопками:
"нет"
"да"
Если пользователь нажимает "нет", то процесс идет дальше.
Если пользователь нажимает 2, то процесс ввода pdf-файла повторяется.
Предыдущее сообщение удаляется. Появляется сообщение, что данные для авансового отчета получены, проходит обработка, когда авансовый отчет будет готов, то он придет сообщением в чат-бот.
3) На стороне бэк-офиса происходит формирование excel-файла с авансовым отчетом. Данные, которые парсятся из pdf-файлов вносятся в авансовый отчет.
4) Пользователю приходит сообщение с вложенным файлом.

- markup кнопка "Помощь". 
1) Пользователь нажимает кнопку "Помощь"
2) Пользователю направляется сообщение с инструкцией (общая информация про бот, что нужно сделать пользователю для использования функционала чат-бота).

# Технологический стек и общая архитектура:
Python
iogram для взаимодействия с пользователем
TBD: стек библиотек для парсинга pdf
TBD: стек библиотек для работы с файлами и 'excel'
SQLite

# Принцип формирования excel файла с отчетом
Есть файл report_template.xlsx с шаблоном отчета с пустыми ячейками, которые нужно заполнить.
По представленным пользователем файлам (электронный билет, приказ на командировку) парсится информация, кторая складывается временно в базу данных.
После завершения формирвоания информации для отчета, формируется новый файл с заполненным авансовым отчетом, который направляется пользователю в виде сообщения.
После направления файл удаляется из файловой системы и данные из базы данных также стираются.

# План реализации.
1. [*] Сформировать файловую структуру проекта.
2. [*] Создать виртуальное окружение.
3. [] Реализовать функционал парсинга информации в файл.
3.1. [] Функционал парсинга приказа.
3.2. [] Функционал парсинга билетов S7.
3.3. [] Функционал парсинга билетов авиакомпании АЛРОСА. 
5. [] Реализовать функционал создания отчета.
6. [] Реализовать функционал чат-бота для взаимодействия пользователя.
7. [] Деплой.